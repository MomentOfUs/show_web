<template>
  <div class="tutorials-container tablet-landscape">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="navbar bg-primary text-white h-11 flex items-center px-4">
      <button @click="goBack" class="mr-4">
        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
        </svg>
      </button>
      <h1 class="font-inter font-medium text-[18px]">ç»´ä¿®æ•™ç¨‹</h1>
    </header>

    <!-- æ•™ç¨‹åˆ†ç±» -->
    <div class="tutorials-tabs bg-white px-4 py-3">
      <div class="flex overflow-x-auto pb-2">
        <button class="tab-item active mr-3 whitespace-nowrap px-4 py-2 rounded-full text-sm" @click="selectCategory('video')">
          è§†é¢‘æ•™ç¨‹
        </button>
        <button class="tab-item mr-3 whitespace-nowrap px-4 py-2 rounded-full text-sm" @click="selectCategory('text')">
          å›¾æ–‡æ•™ç¨‹
        </button>
        <button class="tab-item mr-3 whitespace-nowrap px-4 py-2 rounded-full text-sm" @click="selectCategory('common')">
          å¸¸è§é—®é¢˜
        </button>
      </div>
    </div>

    <!-- è§†é¢‘æ•™ç¨‹åŒº -->
    <div class="video-tutorials p-4" v-if="activeCategory === 'video'">
      <div class="grid grid-cols-1 gap-4">
        <!-- è§†é¢‘å¡ç‰‡1 -->
        <div class="video-card bg-white rounded-xl overflow-hidden shadow-sm" @click="playVideo('battery-replacement')">
          <div class="video-thumbnail relative">
            <img src="https://picsum.photos/400/225?random=1" alt="ç”µæ± æ›´æ¢æ•™ç¨‹" class="w-full h-40 object-cover">
            <div class="play-button absolute inset-0 flex items-center justify-center">
              <div class="w-12 h-12 rounded-full bg-primary/80 flex items-center justify-center">
                <svg class="w-6 h-6 text-white ml-1" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M8 5v14l11-7z"/>
                </svg>
              </div>
            </div>
            <div class="video-duration absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-1 rounded">
              05:32
            </div>
          </div>
          <div class="video-info p-3">
            <h3 class="font-inter font-medium text-base">æ™ºèƒ½æ‰‹æœºç”µæ± æ›´æ¢æ•™ç¨‹</h3>
            <div class="video-meta flex items-center mt-2 text-xs text-gray-600">
              <span class="mr-3">12.5k æ¬¡è§‚çœ‹</span>
              <span>3å¤©å‰æ›´æ–°</span>
            </div>
          </div>
        </div>

        <!-- è§†é¢‘å¡ç‰‡2 -->
        <div class="video-card bg-white rounded-xl overflow-hidden shadow-sm" @click="playVideo('screen-repair')">
          <div class="video-thumbnail relative">
            <img src="https://picsum.photos/400/225?random=2" alt="å±å¹•ä¿®å¤æ•™ç¨‹" class="w-full h-40 object-cover">
            <div class="play-button absolute inset-0 flex items-center justify-center">
              <div class="w-12 h-12 rounded-full bg-primary/80 flex items-center justify-center">
                <svg class="w-6 h-6 text-white ml-1" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M8 5v14l11-7z"/>
                </svg>
              </div>
            </div>
            <div class="video-duration absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-1 rounded">
              08:45
            </div>
          </div>
          <div class="video-info p-3">
            <h3 class="font-inter font-medium text-base">å¹³æ¿ç”µè„‘å±å¹•ä¿®å¤æŒ‡å—</h3>
            <div class="video-meta flex items-center mt-2 text-xs text-gray-600">
              <span class="mr-3">8.3k æ¬¡è§‚çœ‹</span>
              <span>1å‘¨å‰æ›´æ–°</span>
            </div>
          </div>
        </div>

        <!-- è§†é¢‘å¡ç‰‡3 -->
        <div class="video-card bg-white rounded-xl overflow-hidden shadow-sm" @click="playVideo('keyboard-clean')">
          <div class="video-thumbnail relative">
            <img src="https://picsum.photos/400/225?random=3" alt="é”®ç›˜æ¸…æ´æ•™ç¨‹" class="w-full h-40 object-cover">
            <div class="play-button absolute inset-0 flex items-center justify-center">
              <div class="w-12 h-12 rounded-full bg-primary/80 flex items-center justify-center">
                <svg class="w-6 h-6 text-white ml-1" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M8 5v14l11-7z"/>
                </svg>
              </div>
            </div>
            <div class="video-duration absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-1 rounded">
              03:18
            </div>
          </div>
          <div class="video-info p-3">
            <h3 class="font-inter font-medium text-base">ç¬”è®°æœ¬é”®ç›˜æ·±åº¦æ¸…æ´æ•™ç¨‹</h3>
            <div class="video-meta flex items-center mt-2 text-xs text-gray-600">
              <span class="mr-3">15.2k æ¬¡è§‚çœ‹</span>
              <span>2å‘¨å‰æ›´æ–°</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- å›¾æ–‡æ•™ç¨‹åŒº -->
    <div class="text-tutorials p-4" v-if="activeCategory === 'text'">
      <div class="tutorial-detail bg-white rounded-xl p-4 shadow-sm">
        <h2 class="font-inter font-medium text-xl mb-4">ç¬”è®°æœ¬ç”µè„‘æ¸…ç°æ¢ç¡…è„‚æ•™ç¨‹</h2>

        <div class="tutorial-meta flex items-center text-sm text-gray-600 mb-6">
          <span class="mr-4"><i class="mr-1">â±ï¸</i> éš¾åº¦ï¼šä¸­ç­‰</span>
          <span class="mr-4"><i class="mr-1">âŒ›</i> é¢„è®¡æ—¶é—´ï¼š30åˆ†é’Ÿ</span>
          <span><i class="mr-1">ğŸ› ï¸</i> æ‰€éœ€å·¥å…·ï¼šèºä¸åˆ€ã€æ•£çƒ­ç¡…è„‚</span>
        </div>

        <!-- æ­¥éª¤åˆ—è¡¨ -->
        <div class="steps-list space-y-6">
          <div class="step-item" v-for="(step, index) in steps" :key="index" ref="stepItems">
            <div class="step-header flex items-start mb-2">
              <span class="step-number bg-primary text-white rounded-full w-8 h-8 flex items-center justify-center text-sm mr-3 mt-0.5 flex-shrink-0">{{ index + 1 }}</span>
              <h3 class="font-inter font-medium text-base">{{ step.title }}</h3>
            </div>
            <div class="step-content pl-11">
              <img :src="step.image" alt="æ­¥éª¤ {{ index + 1 }}" class="w-full h-48 object-cover rounded-lg mb-3 lazy-image" :data-src="step.image">
              <p class="text-sm text-gray-700">{{ step.description }}</p>
              <div v-if="step.isKeyStep" class="key-step-alert mt-3 bg-yellow-50 border-l-4 border-yellow-400 p-3 text-sm">
                <strong class="text-yellow-700">æ³¨æ„ï¼š</strong> {{ step.alertText }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- è§†é¢‘æ’­æ”¾æ¨¡æ€æ¡† -->
    <div class="modal-overlay" v-if="showVideoPlayer" @click="closeVideoPlayer">
      <div class="video-modal-content bg-black rounded-xl p-5 max-w-md mx-auto" @click.stop>
        <div class="modal-header flex justify-end mb-4">
          <button @click="closeVideoPlayer" class="text-white">
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
        <div class="video-player-container">
          <div class="aspect-w-16 aspect-h-9 bg-gray-900 rounded-lg overflow-hidden">
            <video class="w-full h-full object-contain" controls :src="currentVideoUrl"></video>
          </div>
          <div class="video-title mt-4 text-white font-medium">
            {{ currentVideoTitle }}
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      activeCategory: 'video',
      showVideoPlayer: false,
      currentVideoUrl: '',
      currentVideoTitle: '',
      steps: [
        {
          title: 'å‡†å¤‡å·¥ä½œä¸å·¥å…·',
          image: 'https://picsum.photos/400/225?random=10',
          description: 'å…³é—­ç¬”è®°æœ¬ç”µè„‘ç”µæºï¼Œæ‹”æ‰ç”µæºé€‚é…å™¨ã€‚å‡†å¤‡å¥½æ‰€éœ€å·¥å…·ï¼šåå­—èºä¸åˆ€ã€ä¸€å­—èºä¸åˆ€ã€æ•£çƒ­ç¡…è„‚ã€é…’ç²¾æ£‰ç‰‡ã€å°åˆ·å­å’Œæ’¬æ£’ã€‚',
          isKeyStep: true,
          alertText: 'ç¡®ä¿ç”µè„‘å·²å®Œå…¨æ–­ç”µï¼Œé¿å…é™ç”µæŸåå†…éƒ¨å…ƒä»¶ã€‚'
        },
        {
          title: 'æ‹†å¸ç¬”è®°æœ¬åº•ç›–',
          image: 'https://picsum.photos/400/225?random=11',
          description: 'ä½¿ç”¨åˆé€‚çš„èºä¸åˆ€æ‹§ä¸‹ç¬”è®°æœ¬åº•éƒ¨çš„æ‰€æœ‰èºä¸ï¼Œæ³¨æ„ä¸åŒä½ç½®å¯èƒ½æœ‰ä¸åŒè§„æ ¼çš„èºä¸ã€‚ä½¿ç”¨æ’¬æ£’æ²¿åº•ç›–è¾¹ç¼˜è½»è½»æ’¬å¼€ï¼Œåˆ†ç¦»åº•ç›–ä¸æœºèº«ã€‚',
          isKeyStep: false
        },
        {
          title: 'æ¸…ç†é£æ‰‡ä¸æ•£çƒ­ç‰‡',
          image: 'https://picsum.photos/400/225?random=12',
          description: 'æ‰¾åˆ°é£æ‰‡å’Œæ•£çƒ­ç‰‡ä½ç½®ï¼Œä½¿ç”¨å°åˆ·å­è½»è½»æ¸…ç†è¡¨é¢ç°å°˜ã€‚å¯¹äºé¡½å›ºç°å°˜ï¼Œå¯ç”¨é…’ç²¾æ£‰ç‰‡æ“¦æ‹­ã€‚å¦‚æœé£æ‰‡å™ªéŸ³å¤§ï¼Œå¯è€ƒè™‘æ›´æ¢é£æ‰‡æˆ–æ·»åŠ æ¶¦æ»‘æ²¹ã€‚',
          isKeyStep: true,
          alertText: 'æ¸…ç†æ—¶åŠ¨ä½œè¦è½»ï¼Œé¿å…æŸåé£æ‰‡å¶ç‰‡å’Œæ•£çƒ­é³ç‰‡ã€‚'
        },
        {
          title: 'æ›´æ¢CPUç¡…è„‚',
          image: 'https://picsum.photos/400/225?random=13',
          description: 'å°å¿ƒå–ä¸‹æ•£çƒ­æ¨¡ç»„ï¼Œç”¨é…’ç²¾æ£‰ç‰‡å½»åº•æ¸…æ´CPUå’ŒGPUè¡¨é¢çš„æ—§ç¡…è„‚ã€‚åœ¨CPUå’ŒGPUè¡¨é¢å‡åŒ€æ¶‚æŠ¹ä¸€å±‚è–„è–„çš„æ–°ç¡…è„‚ï¼Œæ³¨æ„ä¸è¦æ¶‚æŠ¹è¿‡å¤šã€‚',
          isKeyStep: true,
          alertText: 'ç¡…è„‚åªéœ€æ¶‚æŠ¹è–„è–„ä¸€å±‚å³å¯ï¼Œè¿‡å¤šåè€Œä¼šå½±å“æ•£çƒ­æ•ˆæœã€‚'
        },
        {
          title: 'é‡æ–°ç»„è£…ç¬”è®°æœ¬',
          image: 'https://picsum.photos/400/225?random=14',
          description: 'æŒ‰ç…§æ‹†å¸çš„ç›¸åé¡ºåºé‡æ–°å®‰è£…æ•£çƒ­æ¨¡ç»„ã€åº•ç›–å’Œèºä¸ã€‚æ³¨æ„èºä¸è¦æŒ‰ç…§å¯¹è§’é¡ºåºé€æ­¥æ‹§ç´§ï¼Œé¿å…ç”¨åŠ›è¿‡çŒ›æŸåä¸»æ¿ã€‚',
          isKeyStep: false
        }
      ]
    };
  },
  mounted() {
    // åˆå§‹åŒ–æ‡’åŠ è½½
    this.initLazyLoading();
  },
  methods: {
    goBack() {
      this.$router.go(-1);
    },
    selectCategory(category) {
      this.activeCategory = category;
      // åˆ‡æ¢åˆ°å›¾æ–‡æ•™ç¨‹æ—¶é‡æ–°åˆå§‹åŒ–æ‡’åŠ è½½
      if (category === 'text') {
        this.$nextTick(() => this.initLazyLoading());
      }
    },
    playVideo(videoKey) {
      // æ¨¡æ‹Ÿè§†é¢‘URL
      this.currentVideoUrl = 'https://example.com/videos/' + videoKey + '.mp4';
      
      // è®¾ç½®è§†é¢‘æ ‡é¢˜
      const videoTitles = {
        'battery-replacement': 'æ™ºèƒ½æ‰‹æœºç”µæ± æ›´æ¢æ•™ç¨‹',
        'screen-repair': 'å¹³æ¿ç”µè„‘å±å¹•ä¿®å¤æŒ‡å—',
        'keyboard-clean': 'ç¬”è®°æœ¬é”®ç›˜æ·±åº¦æ¸…æ´æ•™ç¨‹'
      };
      this.currentVideoTitle = videoTitles[videoKey];
      this.showVideoPlayer = true;
      document.body.style.overflow = 'hidden';
    },
    closeVideoPlayer() {
      this.showVideoPlayer = false;
      document.body.style.overflow = '';
    },
    initLazyLoading() {
      // ä½¿ç”¨Intersection Observerå®ç°å›¾ç‰‡æ‡’åŠ è½½
      const lazyImages = document.querySelectorAll('.lazy-image');
      
      if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const image = entry.target;
              image.src = image.dataset.src;
              image.classList.add('loaded');
              imageObserver.unobserve(image);
            }
          });
        });

        lazyImages.forEach(image => {
          imageObserver.observe(image);
        });
      } else {
        // å›é€€æ–¹æ¡ˆï¼šç«‹å³åŠ è½½æ‰€æœ‰å›¾ç‰‡
        lazyImages.forEach(image => {
          image.src = image.dataset.src;
          image.classList.add('loaded');
        });
      }
    }
  }
};
</script>

<style scoped>
/* æ ‡ç­¾æ ·å¼ */
.tab-item {
  background-color: #F5F5F5;
  color: #666666;
  transition: all 0.2s ease;
}

.tab-item.active {
  background-color: #2196F3;
  color: white;
}

/* è§†é¢‘å¡ç‰‡æ ·å¼ */
.video-card {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.video-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

/* æ’­æ”¾æŒ‰é’®åŠ¨ç”» */
.play-button .w-12 {
  transition: transform 0.3s ease;
}

.video-card:hover .play-button .w-12 {
  transform: scale(1.1);
}

/* æ‡’åŠ è½½å›¾ç‰‡æ ·å¼ */
.lazy-image {
  background-color: #F5F5F5;
  transition: opacity 0.3s ease;
  opacity: 0;
}

.lazy-image.loaded {
  opacity: 1;
}

/* å…³é”®æ­¥éª¤é«˜äº®åŠ¨ç”» */
.key-step-alert {
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0% {
    box-shadow: 0 0 0 0 rgba(255, 204, 0, 0.4);
  }
  70% {
    box-shadow: 0 0 0 6px rgba(255, 204, 0, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(255, 204, 0, 0);
  }
}

/* æ¨¡æ€æ¡†æ ·å¼ */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 100;
}

.video-modal-content {
  max-width: 90vw;
  max-height: 80vh;
  overflow-y: auto;
}
</style>